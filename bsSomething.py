import base64
text= b'ZnJvbSByYW5kb20gaW1wb3J0IHJhbmRpbnQKaW1wb3J0IHJhbmRvbQppbXBvcnQgYnMKaW1wb3J0IG1hdGgKCmNsYXNzIFBvcnRhbEZhY3Rvcnkob2JqZWN0KToKCiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5zaGl0TW9kZWwgPSBicy5nZXRNb2RlbCgnYm9tYicpCiAgICAgICAgc2VsZi50dXJyZXRNb2RlbCA9IGJzLmdldE1vZGVsKCdib21iJykKICAgICAgICBzZWxmLmJhZHJvY2tNb2RlbCA9IGJzLmdldE1vZGVsKCdib21iJykKICAgICAgICBzZWxmLnR1cnJldENsb3NlZE1vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbWInKQogICAgICAgIHNlbGYuY29tcGFuaW9uQ3ViZU1vZGVsID0gYnMuZ2V0TW9kZWwoJ2JvbWInKQoKICAgICAgICBzZWxmLndlaWdodEN1YmVUZXggPSBicy5nZXRUZXh0dXJlKCdiZycpCiAgICAgICAgc2VsZi5taW5lY3JhZnRUZXggPSBicy5nZXRUZXh0dXJlKCdiZycpCiAgICAgICAgc2VsZi5jb21wYW5pb25DdWJlVGV4ID0gYnMuZ2V0VGV4dHVyZSgnYmcnKQoKICAgICAgICBzZWxmLmFjdGl2YXRlU291bmQgPSBicy5nZXRTb3VuZCgnYWN0aXZhdGVCZWVwJykKCiAgICAgICAgc2VsZi5sZWdvTWF0ZXJpYWwgPSBicy5NYXRlcmlhbCgpCiAgICAgICAgc2VsZi5sZWdvTWF0ZXJpYWwuYWRkQWN0aW9ucygKICAgICAgICAgICAgY29uZGl0aW9ucz0oKCd0aGV5SGF2ZU1hdGVyaWFsJywgc2VsZi5sZWdvTWF0ZXJpYWwpKSwKICAgICAgICAgICAgYWN0aW9ucz0oJ21lc3NhZ2UnLCAnb3VyTm9kZScsICdhdENvbm5lY3QnLCBMZWdvQ29ubmVjdCgpKSkKCiAgICAgICAgc2VsZi5sZWdvTWF0ZXJpYWwuYWRkQWN0aW9ucygKICAgICAgICAgICAgY29uZGl0aW9ucz0oKCd0aGV5SGF2ZU1hdGVyaWFsJywKICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgncGxheWVyTWF0ZXJpYWwnKSkpLAogICAgICAgICAgICBhY3Rpb25zPSgnbWVzc2FnZScsICdvdXJOb2RlJywgJ2F0Q29ubmVjdCcsCiAgICAgICAgICAgICAgICAgICAgIExlZ29NZXNzYWdlKCkpKQoKICAgICAgICBzZWxmLmltcGFjdEJsYXN0TWF0ZXJpYWwgPSBicy5NYXRlcmlhbCgpCiAgICAgICAgc2VsZi5pbXBhY3RCbGFzdE1hdGVyaWFsLmFkZEFjdGlvbnMoCiAgICAgICAgICAgIGNvbmRpdGlvbnM9KCgnd2VBcmVPbGRlclRoYW4nLCAyMDApLAogICAgICAgICAgICAgICAgICAgICAgICAnYW5kJywgKCd0aGV5QXJlT2xkZXJUaGFuJywgMjAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCcsICgnZXZhbENvbGxpZGluZycsKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCcsICgoJ3RoZXlIYXZlTWF0ZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ2Zvb3RpbmdNYXRlcmlhbCcpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3InLCAoJ3RoZXlIYXZlTWF0ZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ29iamVjdE1hdGVyaWFsJykpKSksCiAgICAgICAgICAgIGFjdGlvbnM9KCgnbWVzc2FnZScsICdvdXJOb2RlJywgJ2F0Q29ubmVjdCcsIEltcGFjdE1lc3NhZ2UoKSkpKQoKCmNsYXNzIFNvbWV0aGluZyhicy5BY3Rvcik6ICMgVE9ETyAtIGdpdmUgbm9ybWFsIG5hbWUpCiAgICAnJycKICAgIEp1c3QgdHJ5IGRvIGFueSBvYmplY3Qgd2l0aG91dCBicy5Cb21iCicnJwogICAgZGVmIF9faW5pdF9fKHNlbGYsIHBvc2l0aW9uPSgwLCAxLCAwKSwgdmVsb2NpdHk9KDAsMCwwKSwgZGVhdGhUaW1lb3V0ID0gKEZhbHNlLCAwKSk6CiAgICAgICAgYnMuQWN0b3IuX19pbml0X18oc2VsZikKICAgICAgICBhY3Rpdml0eSA9IHNlbGYuZ2V0QWN0aXZpdHkoKQogICAgICAgIHNlbGYuclR5cGU9cmFuZGludCgwLDIpCiAgICAgICAgc2VsZi5jb2xvcj1zZWxmLmdldENvbG9yKHNlbGYuclR5cGUpCiAgICAgICAgc2VsZi5tYXRlcmlhbD1zZWxmLmdldE1hdGVyaWFsKHNlbGYuclR5cGUpCiAgICAgICAgc2VsZi5ib2R5Tm9kZSA9IGJzLm5ld05vZGUoCiAgICAgICAgICAgICdwcm9wJywKICAgICAgICAgICAgZGVsZWdhdGU9c2VsZiwKICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgJ2V4dHJhQWNjZWxlcmF0aW9uJzooMCwxNiwwKSwKICAgICAgICAgICAgICAgICdib2R5Jzonc3BoZXJlJywKICAgICAgICAgICAgICAgICdwb3NpdGlvbic6cG9zaXRpb24sCiAgICAgICAgICAgICAgICAndmVsb2NpdHknOnZlbG9jaXR5LAogICAgICAgICAgICAgICAgJ21hdGVyaWFscyc6WwogICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnb2JqZWN0TWF0ZXJpYWwnKSwKICAgICAgICAgICAgICAgICAgICBzZWxmLm1hdGVyaWFsXQogICAgICAgICAgICAgICAgfSkKICAgICAgICBzZWxmLm5vZGUgPSBicy5uZXdOb2RlKAogICAgICAgICAgICAnc2hpZWxkJywKICAgICAgICAgICAgb3duZXI9c2VsZi5ib2R5Tm9kZSwKICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgJ2NvbG9yJzpzZWxmLmNvbG9yLAogICAgICAgICAgICAgICAgJ3JhZGl1cyc6MC43fSkKICAgICAgICBzZWxmLmJvZHlOb2RlLmNvbm5lY3RBdHRyKCdwb3NpdGlvbicsIHNlbGYubm9kZSwgJ3Bvc2l0aW9uJykKICAgICAgICBpZiBkZWF0aFRpbWVvdXRbMF06CiAgICAgICAgICAgIGJzLmdhbWVUaW1lcihkZWF0aFRpbWVvdXRbMV0sIGJzLkNhbGwoc2VsZi5oYW5kbGVNZXNzYWdlLCBicy5EaWVNZXNzYWdlKCkpKQoKICAgIGRlZiBnZXRDb2xvcihzZWxmLCBpKToKICAgICAgICBzZWxmLmNvbG9ycz1bKDgsMCwwKSwoMCwwLDQpLCg0LDAsOCldICMgSGVhbHRoLCBmcmVlemUsIGN1cnNlCiAgICAgICAgcmV0dXJuIHNlbGYuY29sb3JzW2ldCgogICAgZGVmIGdldE1hdGVyaWFsKHNlbGYsIGkpOgogICAgICAgIHNlbGYubWF0ZXJpYWxIZWFsdGg9YnMuTWF0ZXJpYWwoKQogICAgICAgIHNlbGYubWF0ZXJpYWxGcmVlemU9YnMuTWF0ZXJpYWwoKQogICAgICAgIHNlbGYubWF0ZXJpYWxDdXJzZT1icy5NYXRlcmlhbCgpCgogICAgICAgICMgU2V0dXAgSGVhbHRoCiAgICAgICAgc2VsZi5tYXRlcmlhbEhlYWx0aC5hZGRBY3Rpb25zKAogICAgICAgICAgICBjb25kaXRpb25zPSgoKCd0aGV5QXJlT2xkZXJUaGFuJywgMTAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICdhbmQnLCAoJ3RoZXlIYXZlTWF0ZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ3BsYXllck1hdGVyaWFsJykpKSksCiAgICAgICAgICAgIGFjdGlvbnM9KCdtZXNzYWdlJywgJ3RoZWlyTm9kZScsJ2F0Q29ubmVjdCcsIGJzLlBvd2VydXBNZXNzYWdlKCdoZWFsdGgnKSkpCiAgICAgICAgIyBTZXR1cCBGcmVlemUKICAgICAgICBzZWxmLm1hdGVyaWFsRnJlZXplLmFkZEFjdGlvbnMoCiAgICAgICAgICAgIGNvbmRpdGlvbnM9KCgoJ3RoZXlBcmVPbGRlclRoYW4nLCAxMDApLAogICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCcsICgndGhleUhhdmVNYXRlcmlhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgncGxheWVyTWF0ZXJpYWwnKSkpKSwKICAgICAgICAgICAgYWN0aW9ucz0oJ21lc3NhZ2UnLCAndGhlaXJOb2RlJywnYXRDb25uZWN0JywgYnMuRnJlZXplTWVzc2FnZSgpKSkKICAgICAgICAjIFNldHVwIEN1cnNlCiAgICAgICAgc2VsZi5tYXRlcmlhbEN1cnNlLmFkZEFjdGlvbnMoCiAgICAgICAgICAgIGNvbmRpdGlvbnM9KCgoJ3RoZXlBcmVPbGRlclRoYW4nLCAxMDApLAogICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCcsICgndGhleUhhdmVNYXRlcmlhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgncGxheWVyTWF0ZXJpYWwnKSkpKSwKICAgICAgICAgICAgYWN0aW9ucz0oJ21lc3NhZ2UnLCAndGhlaXJOb2RlJywnYXRDb25uZWN0JywgYnMuUG93ZXJ1cE1lc3NhZ2UoJ2hpZ2hsaWdodCcpKSkKICAgICAgICBzZWxmLm1hdGVyaWFscz1bc2VsZi5tYXRlcmlhbEhlYWx0aCwgc2VsZi5tYXRlcmlhbEZyZWV6ZSwgc2VsZi5tYXRlcmlhbEN1cnNlXQogICAgICAgIHJldHVybiBzZWxmLm1hdGVyaWFsc1tpXQoKICAgIGRlZiBoYW5kbGVNZXNzYWdlKHNlbGYsIG0pOgogICAgICAgIGlmIGlzaW5zdGFuY2UobSwgYnMuRGllTWVzc2FnZSk6CiAgICAgICAgICAgIGlmIHNlbGYubm9kZSBpcyBub3QgTm9uZSBhbmQgc2VsZi5ub2RlLmV4aXN0cygpOgogICAgICAgICAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKCdzaGF0dGVyJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSBzZWxmLm5vZGUucG9zaXRpb24pCiAgICAgICAgICAgICAgICBicy5lbWl0QkdEeW5hbWljcyhwb3NpdGlvbiA9IHNlbGYubm9kZS5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5ID0gKDAsIDQsIDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQgPSAxNCwgc2NhbGUgPSAwLjgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua1R5cGUgPSAnc3BhcmsnLCBzcHJlYWQgPSAxLjUpCiAgICAgICAgICAgIHNlbGYubm9kZS5kZWxldGUoKQogICAgICAgICAgICBzZWxmLmJvZHlOb2RlLmRlbGV0ZSgpCiAgICAgICAgCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIGJzLk91dE9mQm91bmRzTWVzc2FnZSk6CiAgICAgICAgICAgIHNlbGYubm9kZS5kZWxldGUoKQogICAgICAgICAgICBzZWxmLmJvZHlOb2RlLmRlbGV0ZSgpCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShtLCBicy5IaXRNZXNzYWdlKToKICAgICAgICAgICAgc2VsZi5ub2RlLmhhbmRsZU1lc3NhZ2UoCiAgICAgICAgICAgICAgICAiaW1wdWxzZSIsIG0ucG9zWzBdLCBtLnBvc1sxXSwgbS5wb3NbMl0sIG0udmVsb2NpdHlbMF0sCiAgICAgICAgICAgICAgICBtLnZlbG9jaXR5WzFdLCBtLnZlbG9jaXR5WzJdLCAxLjAgKiBtLm1hZ25pdHVkZSwKICAgICAgICAgICAgICAgIDEuMCAqIG0udmVsb2NpdHlNYWduaXR1ZGUsIG0ucmFkaXVzLCAwLCBtLmZvcmNlRGlyZWN0aW9uWzBdLAogICAgICAgICAgICAgICAgbS5mb3JjZURpcmVjdGlvblsxXSwgbS5mb3JjZURpcmVjdGlvblsyXSkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYnMuQWN0b3IuaGFuZGxlTWVzc2FnZShzZWxmLCBtKQoKCgpjbGFzcyBCdWlsZEJsb2NrKGJzLkFjdG9yKToKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIHBvc2l0aW9uPSgwLDEsMCkpOgogICAgICAgIAogICAgICAgIGJzLkFjdG9yLl9faW5pdF9fKHNlbGYpCgogICAgICAgICMgV2hlcmUgZG8gd2UgcGxhY2UgYmxvY2s/CiAgICAgICAgc2VsZi5sb2M9YnMubmV3Tm9kZSgnc2hpZWxkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzPXsncG9zaXRpb24nOnBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyYWRpdXMnOjAuMDF9KQoKICAgICAgICAjIEJsb2NrCiAgICAgICAgc2VsZi5ib2R5PWJzLm5ld05vZGUoJ3Byb3AnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGVnYXRlPXNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9eydib2R5JzonYm94JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21vZGVsU2NhbGUnOjEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdib2R5U2NhbGUnOjEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbCc6YnMuZ2V0TW9kZWwoJ3RudCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JUZXh0dXJlJzpicy5nZXRUZXh0dXJlKCd0bnQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21hdGVyaWFscyc6W2JzLmdldFNoYXJlZE9iamVjdCgnZm9vdGluZ01hdGVyaWFsJyldfSkKICAgICAgICBzZWxmLmxvYy5jb25uZWN0QXR0cigncG9zaXRpb24nLCBzZWxmLmJvZHksICdwb3NpdGlvbicpCgogICAgZGVmIGhhbmRsZU1lc3NhZ2Uoc2VsZiwgbSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShtLCBicy5EaWVNZXNzYWdlKToKICAgICAgICAgICAgc2VsZi5ib2R5LmRlbGV0ZSgpCiAgICAgICAgICAgIHNlbGYubG9jLmRlbGV0ZSgpCiAgICAgICAgICAgIGFjdGl2aXR5ID0gc2VsZi5nZXRBY3Rpdml0eSgpCiAgICAgICAgCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIGJzLk91dE9mQm91bmRzTWVzc2FnZSk6CiAgICAgICAgICAgIHNlbGYuYm9keS5kZWxldGUoKQogICAgICAgICAgICBzZWxmLmxvYy5kZWxldGUoKQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBicy5BY3Rvci5oYW5kbGVNZXNzYWdlKHNlbGYsIG0pCgpjbGFzcyBNYWdpY0dlbmVyYXRvcihicy5BY3Rvcik6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHBvc2l0aW9uID0gKDAsMSwwKSwgbWF4QmFsbHMgPSA1KToKCiAgICAgICAgYnMuQWN0b3IuX19pbml0X18oc2VsZikKCiAgICAgICAgc2VsZi5iYWxscyA9IFtdCgogICAgICAgIHNlbGYubWF4QmFsbHMgPSBtYXhCYWxscwoKICAgICAgICBzZWxmLm5vZGUgPSBicy5uZXdOb2RlKCdwcm9wJywgZGVsZWdhdGUgPSBzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2V4dHJhQWNjZWxlcmF0aW9uJzooMCwxOCwwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOnBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbCc6YnMuZ2V0TW9kZWwoJ3RudCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsaWdodE1vZGVsJzpicy5nZXRNb2RlbCgndG50JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JvZHknOidjcmF0ZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NoYWRvd1NpemUnOjAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JUZXh0dXJlJzpicy5nZXRUZXh0dXJlKCdhY2hpZXZlbWVudEZsYXdsZXNzVmljdG9yeScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uJzonc29mdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZmxlY3Rpb25TY2FsZSc6WzFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtYXRlcmlhbHMnOlticy5nZXRTaGFyZWRPYmplY3QoJ29iamVjdE1hdGVyaWFsJyldfSkKICAgICAgICBzZWxmLnRpbWVyID0gYnMuVGltZXIoNTAwMCwgYnMuQ2FsbChzZWxmLnNwYXduQmFsbCksIHJlcGVhdCA9IFRydWUpCgogICAgZGVmIHNwYXduQmFsbChzZWxmKToKICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oc2VsZi5iYWxscykpOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5iYWxsc1tpXS5ub2RlLmV4aXN0cygpOgogICAgICAgICAgICAgICAgZGVsIHNlbGYuYmFsbHNbaV0KICAgICAgICAgICAgICAgIGkgLT0gMQoKICAgICAgICBpZiBsZW4oc2VsZi5iYWxscykgPj0gc2VsZi5tYXhCYWxsczogcmV0dXJuCiAgICAgICAgeCwgeSwgeiA9IHNlbGYubm9kZS5wb3NpdGlvbgogICAgICAgIHkgKz0gMgogICAgICAgIHNlbGYuYmFsbHMuYXBwZW5kKFNvbWV0aGluZygoeCx5LHopKSkKCiAgICBkZWYgaGFuZGxlTWVzc2FnZShzZWxmLCBtKToKICAgICAgICBpZiBpc2luc3RhbmNlKG0sIGJzLkRpZU1lc3NhZ2UpOgogICAgICAgICAgICBzZWxmLm5vZGUuZGVsZXRlKCkKICAgICAgICAgICAgc2VsZi50aW1lciA9IE5vbmUKICAgICAgICAKICAgICAgICBlbGlmIGlzaW5zdGFuY2UobSwgYnMuT3V0T2ZCb3VuZHNNZXNzYWdlKToKICAgICAgICAgICAgc2VsZi5ub2RlLmRlbGV0ZSgpCiAgICAgICAgICAgIHNlbGYudGltZXIgPSBOb25lCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShtLCBicy5IaXRNZXNzYWdlKToKICAgICAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKCdzaGF0dGVyJyksCiAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHNlbGYubm9kZS5wb3NpdGlvbikKICAgICAgICAgICAgYnMuZW1pdEJHRHluYW1pY3MocG9zaXRpb24gPSBzZWxmLm5vZGUucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5ID0gKDAsIDQsIDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDE0LCBzY2FsZSA9IDAuOCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtUeXBlID0gJ3NwYXJrJywgc3ByZWFkID0gMS41KQogICAgICAgICAgICBzZWxmLm5vZGUuZGVsZXRlKCkKICAgICAgICAgICAgc2VsZi50aW1lciA9IE5vbmUKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYnMuQWN0b3IuaGFuZGxlTWVzc2FnZShzZWxmLCBtKQogICAgICAgICAgICAKY2xhc3MgQmxhY2tIb2xlKGJzLkFjdG9yKToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgcG9zaXRpb249KDAsIDEsIDApLCBhdXRvRXhwYW5kPVRydWUsIHNjYWxlPTEsCiAgICAgICAgICAgICAgICAgZG9Ob3RSYW5kb21pemU9RmFsc2UsIGluZmluaXR5PUZhbHNlLCBvd25lcj1Ob25lKToKICAgICAgICBicy5BY3Rvci5fX2luaXRfXyhzZWxmKQogICAgICAgIHNlbGYuc2hpZWxkcyA9IFtdCiAgICAgICAgaWYgbm90IGRvTm90UmFuZG9taXplOgogICAgICAgICAgICBzZWxmLnBvc2l0aW9uID0gKHBvc2l0aW9uWzBdIC0gMiArIHJhbmRvbS5yYW5kb20oKSo0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uWzFdICsgcmFuZG9tLnJhbmRvbSgpKjIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25bMl0gLSAyICsgcmFuZG9tLnJhbmRvbSgpKjQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5wb3NpdGlvbiA9IHBvc2l0aW9uCgogICAgICAgIHNlbGYuc2NhbGUgPSBzY2FsZQogICAgICAgIHNlbGYuc3Vja09iamVjdHMgPSBbXQogICAgICAgIHNlbGYub3duZXIgPSBvd25lcgoKICAgICAgICBzZWxmLmJsYWNrSG9sZU1hdGVyaWFsID0gYnMuTWF0ZXJpYWwoKQogICAgICAgIHNlbGYuYmxhY2tIb2xlTWF0ZXJpYWwuYWRkQWN0aW9ucygKICAgICAgICAgICAgY29uZGl0aW9ucz0oKCd0aGV5RG9udEhhdmVNYXRlcmlhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ29iamVjdE1hdGVyaWFsJykpLAogICAgICAgICAgICAgICAgICAgICAgICAnYW5kJywgKCd0aGV5SGF2ZU1hdGVyaWFsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ3BsYXllck1hdGVyaWFsJykpKSwKICAgICAgICAgICAgYWN0aW9ucz0oKCdtb2RpZnlQYXJ0Q29sbGlzaW9uJywgJ2NvbGxpZGUnLCBUcnVlKSwKICAgICAgICAgICAgICAgICAgICAgKCdtb2RpZnlQYXJ0Q29sbGlzaW9uJywgJ3BoeXNpY2FsJywgRmFsc2UpLAogICAgICAgICAgICAgICAgICAgICAoJ2NhbGwnLCAnYXRDb25uZWN0Jywgc2VsZi50b3VjaGVkU3BheikpKQoKICAgICAgICBzZWxmLmJsYWNrSG9sZU1hdGVyaWFsLmFkZEFjdGlvbnMoCiAgICAgICAgICAgIGNvbmRpdGlvbnM9KCgndGhleURvbnRIYXZlTWF0ZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdwbGF5ZXJNYXRlcmlhbCcpKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCcsICgndGhleUhhdmVNYXRlcmlhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdvYmplY3RNYXRlcmlhbCcpKSksCiAgICAgICAgICAgIGFjdGlvbnM9KCgnbW9kaWZ5UGFydENvbGxpc2lvbicsICdjb2xsaWRlJywgVHJ1ZSksCiAgICAgICAgICAgICAgICAgICAgICgnbW9kaWZ5UGFydENvbGxpc2lvbicsICdwaHlzaWNhbCcsIEZhbHNlKSwKICAgICAgICAgICAgICAgICAgICAgKCdjYWxsJywgJ2F0Q29ubmVjdCcsIHNlbGYudG91Y2hlZE9iaikpKQoKICAgICAgICBzZWxmLnN1Y2tNYXRlcmlhbCA9IGJzLk1hdGVyaWFsKCkKICAgICAgICBzZWxmLnN1Y2tNYXRlcmlhbC5hZGRBY3Rpb25zKAogICAgICAgICAgICBjb25kaXRpb25zPSgoJ3RoZXlIYXZlTWF0ZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdvYmplY3RNYXRlcmlhbCcpKSksCiAgICAgICAgICAgIGFjdGlvbnM9KCgnbW9kaWZ5UGFydENvbGxpc2lvbicsICdjb2xsaWRlJywgVHJ1ZSksCiAgICAgICAgICAgICAgICAgICAgICgnbW9kaWZ5UGFydENvbGxpc2lvbicsICdwaHlzaWNhbCcsIEZhbHNlKSwKICAgICAgICAgICAgICAgICAgICAgKCdjYWxsJywgJ2F0Q29ubmVjdCcsIHNlbGYudG91Y2hlZE9ialN1Y2spKSkKCiAgICAgICAgc2VsZi5ub2RlID0gYnMubmV3Tm9kZSgncmVnaW9uJywgYXR0cnM9ewogICAgICAgICAgICAncG9zaXRpb24nOiAoc2VsZi5wb3NpdGlvblswXSwgc2VsZi5wb3NpdGlvblsxXSwgc2VsZi5wb3NpdGlvblsyXSksCiAgICAgICAgICAgICdzY2FsZSc6IChzY2FsZSwgc2NhbGUsIHNjYWxlKSwKICAgICAgICAgICAgJ3R5cGUnOiAnc3BoZXJlJywKICAgICAgICAgICAgJ21hdGVyaWFscyc6IFtzZWxmLmJsYWNrSG9sZU1hdGVyaWFsXX0pCgogICAgICAgIHNlbGYuc3Vja1JhZGl1cyA9IGJzLm5ld05vZGUoJ3JlZ2lvbicsIGF0dHJzPXsKICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKHNlbGYucG9zaXRpb25bMF0sIHNlbGYucG9zaXRpb25bMV0sIHNlbGYucG9zaXRpb25bMl0pLAogICAgICAgICAgICAnc2NhbGUnOiAoc2NhbGUsIHNjYWxlLCBzY2FsZSksCiAgICAgICAgICAgICd0eXBlJzogJ3NwaGVyZScsCiAgICAgICAgICAgICdtYXRlcmlhbHMnOiBbc2VsZi5zdWNrTWF0ZXJpYWxdfSkKCiAgICAgICAgZGVmIGRpc3QoKToKICAgICAgICAgICAgYnMuZW1pdEJHRHluYW1pY3MoCiAgICAgICAgICAgICAgICBwb3NpdGlvbj1zZWxmLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgZW1pdFR5cGU9J2Rpc3RvcnRpb24nLAogICAgICAgICAgICAgICAgc3ByZWFkPTYsCiAgICAgICAgICAgICAgICBjb3VudD0xMDApCgogICAgICAgICAgICBpZiBzZWxmLm5vZGUuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICBicy5nYW1lVGltZXIoMTAwMCwgZGlzdCkKCiAgICAgICAgZGlzdCgpCiAgICAgICAgaWYgbm90IGluZmluaXR5OgogICAgICAgICAgICBzZWxmLl9kaWVUaW1lciA9IGJzLlRpbWVyKDI1MDAwLCBicy5XZWFrQ2FsbChzZWxmLmV4cGxvZGUpKQoKICAgICAgICBzY2FsZTEgPSB7CiAgICAgICAgICAgIDA6ICgwLCAwLCAwKSwKICAgICAgICAgICAgMzAwOiAoc2VsZi5zY2FsZSwgc2VsZi5zY2FsZSwgc2VsZi5zY2FsZSkKICAgICAgICB9CgogICAgICAgIHNjYWxlMiA9IHsKICAgICAgICAgICAgMDogKDAsIDAsIDApLAogICAgICAgICAgICAzMDA6IChzZWxmLnNjYWxlKjgsIHNlbGYuc2NhbGUqOCwgc2VsZi5zY2FsZSo4KQogICAgICAgIH0KCiAgICAgICAgYnMuYW5pbWF0ZUFycmF5KHNlbGYubm9kZSwgJ3NjYWxlJywgMywgc2NhbGUxLCBUcnVlKQogICAgICAgIGJzLmFuaW1hdGVBcnJheShzZWxmLnN1Y2tSYWRpdXMsICdzY2FsZScsIDMsIHNjYWxlMiwgVHJ1ZSkKCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMjApOgogICAgICAgICAgICBzZWxmLnNoaWVsZHMuYXBwZW5kKAogICAgICAgICAgICAgICAgYnMubmV3Tm9kZSgnc2hpZWxkJywgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICdjb2xvcic6IChyYW5kb20ucmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbS5yYW5kb20oKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tLnJhbmRvbSgpKSwKICAgICAgICAgICAgICAgICAgICAncmFkaXVzJzogc2VsZi5zY2FsZSoyLAogICAgICAgICAgICAgICAgICAgICdwb3NpdGlvbic6IHNlbGYucG9zaXRpb259KSkKCiAgICAgICAgZGVmIHNvdW5kKCk6CiAgICAgICAgICAgIGJzLnBsYXlTb3VuZChicy5nZXRTb3VuZCgnYmxhY2tIb2xlJykpCgogICAgICAgIHNvdW5kKCkKICAgICAgICBpZiBpbmZpbml0eToKICAgICAgICAgICAgc2VsZi5zb3VuZDIgPSBicy5UaW1lcigyNTAwMCwgYnMuQ2FsbChzb3VuZCksIHJlcGVhdD1pbmZpbml0eSkKCiAgICBkZWYgYWRkTWFzcyhzZWxmKToKICAgICAgICBzZWxmLnNjYWxlICs9IDAuMTUKICAgICAgICBzZWxmLm5vZGUuc2NhbGUgPSAoc2VsZi5zY2FsZSwgc2VsZi5zY2FsZSwgc2VsZi5zY2FsZSkKICAgICAgICBmb3IgaSBpbiByYW5nZSgyKToKICAgICAgICAgICAgc2VsZi5zaGllbGRzLmFwcGVuZCgKICAgICAgICAgICAgICAgIGJzLm5ld05vZGUoJ3NoaWVsZCcsIGF0dHJzPXsKICAgICAgICAgICAgICAgICAgICAnY29sb3InOiAocmFuZG9tLnJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb20ucmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbS5yYW5kb20oKSksCiAgICAgICAgICAgICAgICAgICAgJ3JhZGl1cyc6IHNlbGYuc2NhbGUrMC4xNSwKICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBzZWxmLnBvc2l0aW9ufSkpCgogICAgZGVmIGV4cGxvZGUoc2VsZik6CiAgICAgICAgYnMuZW1pdEJHRHluYW1pY3MoCiAgICAgICAgICAgIHBvc2l0aW9uPXNlbGYucG9zaXRpb24sCiAgICAgICAgICAgIGNvdW50PTUwMCwKICAgICAgICAgICAgc2NhbGU9MSwKICAgICAgICAgICAgc3ByZWFkPTEuNSwKICAgICAgICAgICAgY2h1bmtUeXBlPSdzcGFyaycpCgogICAgICAgIGZvciBpIGluIHNlbGYuc2hpZWxkczoKICAgICAgICAgICAgYnMuYW5pbWF0ZShpLCAncmFkaXVzJywKICAgICAgICAgICAgICAgICAgICAgICB7MDogMCwgMjAwOiBpLnJhZGl1cyo1fSkKCiAgICAgICAgYnMuQmxhc3QoCiAgICAgICAgICAgIHBvc2l0aW9uPXNlbGYucG9zaXRpb24sCiAgICAgICAgICAgIGJsYXN0UmFkaXVzPTEwKS5hdXRvUmV0YWluKCkKCiAgICAgICAgZm9yIGkgaW4gc2VsZi5zaGllbGRzOgogICAgICAgICAgICBpLmRlbGV0ZSgpCgogICAgICAgIHNlbGYubm9kZS5kZWxldGUoKQogICAgICAgIHNlbGYuc3Vja1JhZGl1cy5kZWxldGUoKQogICAgICAgIHNlbGYubm9kZS5oYW5kbGVNZXNzYWdlKGJzLkRpZU1lc3NhZ2UoKSkKICAgICAgICBzZWxmLnN1Y2tSYWRpdXMuaGFuZGxlTWVzc2FnZShicy5EaWVNZXNzYWdlKCkpCgogICAgZGVmIHRvdWNoZWRTcGF6KHNlbGYpOgogICAgICAgIG5vZGUgPSBicy5nZXRDb2xsaXNpb25JbmZvKCdvcHBvc2luZ05vZGUnKQogICAgICAgIGJzLkJsYXN0KAogICAgICAgICAgICBwb3NpdGlvbj1ub2RlLnBvc2l0aW9uLAogICAgICAgICAgICBibGFzdFR5cGU9J3R1cnJldCcpLmF1dG9SZXRhaW4oKQoKICAgICAgICBpZiBub2RlLmV4aXN0cygpOgogICAgICAgICAgICBpZiBzZWxmLm93bmVyLmV4aXN0cygpOgogICAgICAgICAgICAgICAgbm9kZS5oYW5kbGVNZXNzYWdlKAogICAgICAgICAgICAgICAgICAgIGJzLkhpdE1lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgIG1hZ25pdHVkZT0xMDAwLjAsCiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVBsYXllcj1zZWxmLm93bmVyLmdldERlbGVnYXRlKCkuZ2V0UGxheWVyKCkpKQoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBub2RlLmhhbmRsZU1lc3NhZ2UoYnMuRGllTWVzc2FnZSgpKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgICAgICBicy5zaGFrZUNhbWVyYSgyKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbm9kZS5oYW5kbGVNZXNzYWdlKGJzLkRpZU1lc3NhZ2UoKSkKCiAgICAgICAgc2VsZi5hZGRNYXNzKCkKCiAgICBkZWYgdG91Y2hlZE9iaihzZWxmKToKICAgICAgICBub2RlID0gYnMuZ2V0Q29sbGlzaW9uSW5mbygnb3Bwb3NpbmdOb2RlJykKICAgICAgICBicy5CbGFzdCgKICAgICAgICAgICAgcG9zaXRpb249bm9kZS5wb3NpdGlvbiwKICAgICAgICAgICAgYmxhc3RUeXBlPSd0dXJyZXQnKS5hdXRvUmV0YWluKCkKCiAgICAgICAgaWYgbm9kZS5leGlzdHMoKToKICAgICAgICAgICAgbm9kZS5oYW5kbGVNZXNzYWdlKGJzLkRpZU1lc3NhZ2UoKSkKCiAgICBkZWYgdG91Y2hlZE9ialN1Y2soc2VsZik6CiAgICAgICAgbm9kZSA9IGJzLmdldENvbGxpc2lvbkluZm8oJ29wcG9zaW5nTm9kZScpCiAgICAgICAgaWYgbm9kZS5nZXROb2RlVHlwZSgpIGluIFsncHJvcCcsICdib21iJ106CiAgICAgICAgICAgIHNlbGYuc3Vja09iamVjdHMuYXBwZW5kKG5vZGUpCgogICAgICAgIGZvciBpIGluIHNlbGYuc3Vja09iamVjdHM6CiAgICAgICAgICAgIGlmIGkuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICBpZiBpLnN0aWNreToKICAgICAgICAgICAgICAgICAgICBpLnN0aWNreSA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgaS5leHRyYUFjY2VsZXJhdGlvbiA9ICgwLCAxMCwgMCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaS5leHRyYUFjY2VsZXJhdGlvbiA9ICgKICAgICAgICAgICAgICAgICAgICAgICAgKHNlbGYucG9zaXRpb25bMF0gLSBpLnBvc2l0aW9uWzBdKSo4LAogICAgICAgICAgICAgICAgICAgICAgICAoc2VsZi5wb3NpdGlvblsxXSAtIGkucG9zaXRpb25bMV0pKjI1LAogICAgICAgICAgICAgICAgICAgICAgICAoc2VsZi5wb3NpdGlvblsyXSAtIGkucG9zaXRpb25bMl0pKjgpCgogICAgZGVmIGhhbmRsZU1lc3NhZ2Uoc2VsZiwgbSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShtLCBicy5EaWVNZXNzYWdlKToKICAgICAgICAgICAgaWYgc2VsZi5ub2RlLmV4aXN0cygpOgogICAgICAgICAgICAgICAgc2VsZi5ub2RlLmRlbGV0ZSgpCgogICAgICAgICAgICBpZiBzZWxmLnN1Y2tSYWRpdXMuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICBzZWxmLnN1Y2tSYWRpdXMuZGVsZXRlKCkKCiAgICAgICAgICAgIHNlbGYuX3VwZFRpbWVyID0gTm9uZQogICAgICAgICAgICBzZWxmLl9zdWNrVGltZXIgPSBOb25lCiAgICAgICAgICAgIHNlbGYuc291bmQyID0gTm9uZQogICAgICAgICAgICBzZWxmLnN1Y2tPYmplY3RzID0gW10KCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIGJzLk91dE9mQm91bmRzTWVzc2FnZSk6CiAgICAgICAgICAgIHNlbGYubm9kZS5oYW5kbGVNZXNzYWdlKGJzLkRpZU1lc3NhZ2UoKSkKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIEJsYWNrSG9sZU1lc3NhZ2UpOgogICAgICAgICAgICBub2RlID0gYnMuZ2V0Q29sbGlzaW9uSW5mbygnb3Bwb3NpbmdOb2RlJykKICAgICAgICAgICAgYnMuQmxhc3QoCiAgICAgICAgICAgICAgICBwb3NpdGlvbj1zZWxmLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgYmxhc3RUeXBlPSdub3JtYWwnKS5hdXRvUmV0YWluKCkKCiAgICAgICAgICAgIGlmIG5vdCBub2RlLmludmluY2libGU6CiAgICAgICAgICAgICAgICBub2RlLnNoYXR0ZXJlZCA9IDIKICAgICAgICAgICAgICAgIApjbGFzcyBTaG9ja1dhdmUoYnMuQWN0b3IpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwb3NpdGlvbj0oMCwgMSwgMCksIHJhZGl1cz0yLCBzcGVlZD0xMDApOgogICAgICAgIGJzLkFjdG9yLl9faW5pdF9fKHNlbGYpCiAgICAgICAgc2VsZi5yYWRpdXMgPSByYWRpdXMKICAgICAgICBzZWxmLnBvc2l0aW9uID0gcG9zaXRpb24KICAgICAgICBzZWxmLnMgPSBOb25lCgogICAgICAgIHNlbGYuc2hvY2tXYXZlTWF0ZXJpYWwgPSBicy5NYXRlcmlhbCgpCiAgICAgICAgc2VsZi5zaG9ja1dhdmVNYXRlcmlhbC5hZGRBY3Rpb25zKAogICAgICAgICAgICBjb25kaXRpb25zPSgoJ3RoZXlIYXZlTWF0ZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdwbGF5ZXJNYXRlcmlhbCcpKSksCiAgICAgICAgICAgIGFjdGlvbnM9KCgnbW9kaWZ5UGFydENvbGxpc2lvbicsICdjb2xsaWRlJywgVHJ1ZSksCiAgICAgICAgICAgICAgICAgICAgICgnbW9kaWZ5UGFydENvbGxpc2lvbicsICdwaHlzaWNhbCcsIEZhbHNlKSwKICAgICAgICAgICAgICAgICAgICAgKCdjYWxsJywgJ2F0Q29ubmVjdCcsIHNlbGYudG91Y2hlZFNwYXopKSkKCiAgICAgICAgc2VsZi5zaG9ja1dhdmVNYXRlcmlhbC5hZGRBY3Rpb25zKAogICAgICAgICAgICBjb25kaXRpb25zPSgoJ3RoZXlIYXZlTWF0ZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdvYmplY3RNYXRlcmlhbCcpKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCcsICgndGhleURvbnRIYXZlTWF0ZXJpYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgncGxheWVyTWF0ZXJpYWwnKSkpLAogICAgICAgICAgICBhY3Rpb25zPSgoJ21vZGlmeVBhcnRDb2xsaXNpb24nLCAnY29sbGlkZScsIFRydWUpLAogICAgICAgICAgICAgICAgICAgICAoJ21vZGlmeVBhcnRDb2xsaXNpb24nLCAncGh5c2ljYWwnLCBGYWxzZSksCiAgICAgICAgICAgICAgICAgICAgICgnY2FsbCcsICdhdENvbm5lY3QnLCBzZWxmLnRvdWNoZWRPYmopKSkKCiAgICAgICAgc2VsZi5ub2RlID0gYnMubmV3Tm9kZSgncmVnaW9uJywgYXR0cnM9ewogICAgICAgICAgICAncG9zaXRpb24nOiAoc2VsZi5wb3NpdGlvblswXSwKICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucG9zaXRpb25bMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnBvc2l0aW9uWzJdKSwKICAgICAgICAgICAgJ3NjYWxlJzogKDAuMSwgMC4xLCAwLjEpLAogICAgICAgICAgICAndHlwZSc6ICdzcGhlcmUnLAogICAgICAgICAgICAnbWF0ZXJpYWxzJzogW3NlbGYuc2hvY2tXYXZlTWF0ZXJpYWxdfSkKCiAgICAgICAgZXhwbG9zaW9uID0gYnMubmV3Tm9kZSgnZXhwbG9zaW9uJywgYXR0cnM9ewogICAgICAgICAgICAncG9zaXRpb24nOiBzZWxmLm5vZGUucG9zaXRpb24sCiAgICAgICAgICAgICdyYWRpdXMnOiAxLAogICAgICAgICAgICAnYmlnJzogVHJ1ZSwKICAgICAgICAgICAgJ2NvbG9yJzogKDAuMywgMC4zLCAxLjApfSkKCiAgICAgICAgZGVmIGRvd2F2ZXMoKToKICAgICAgICAgICAgc2VsZi52aXN1YWxSYWRpdXMgPSBicy5uZXdOb2RlKCdzaGllbGQnLCBhdHRycz17CiAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBzZWxmLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogKDAuMDUsIDAuMDUsIDAuMSksCiAgICAgICAgICAgICAgICAncmFkaXVzJzogMC4wNX0pCgogICAgICAgICAgICBicy5hbmltYXRlKHNlbGYudmlzdWFsUmFkaXVzLCAncmFkaXVzJywKICAgICAgICAgICAgICAgICAgICAgICB7MDogMCwgc3BlZWQ6IHNlbGYucmFkaXVzKjJ9KQoKICAgICAgICAgICAgYnMuZ2FtZVRpbWVyKHNwZWVkKzEsIHNlbGYudmlzdWFsUmFkaXVzLmRlbGV0ZSkKCiAgICAgICAgc2NhbGUgPSB7MDogKDAsIDAsIDApLCBzcGVlZDogKHNlbGYucmFkaXVzLCBzZWxmLnJhZGl1cywgc2VsZi5yYWRpdXMpfQogICAgICAgIGJzLmFuaW1hdGVBcnJheShzZWxmLm5vZGUsICdzY2FsZScsIDMsIHNjYWxlLCBUcnVlKQoKICAgICAgICBicy5CbGFzdCgKICAgICAgICAgICAgcG9zaXRpb249c2VsZi5wb3NpdGlvbiwKICAgICAgICAgICAgYmxhc3RSYWRpdXM9MSkuYXV0b1JldGFpbigpCgogICAgICAgIGJzLkNhbGwoZG93YXZlcykKICAgICAgICBicy5nYW1lVGltZXIoMTAwLCBicy5DYWxsKGRvd2F2ZXMpKQogICAgICAgIGJzLmdhbWVUaW1lcigyMDAsIGJzLkNhbGwoZG93YXZlcykpCiAgICAgICAgYnMuZ2FtZVRpbWVyKDI1MCwgZXhwbG9zaW9uLmRlbGV0ZSkKICAgICAgICBicy5nYW1lVGltZXIoMzAwLCBicy5DYWxsKGRvd2F2ZXMpKQogICAgICAgIGJzLmdhbWVUaW1lcig3MDAsIHNlbGYubm9kZS5kZWxldGUpCgogICAgZGVmIHJlKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5ub2RlMi5nZXREZWxlZ2F0ZSgpLl9wdW5jaFBvd2VyU2NhbGUgPSBzZWxmLnMKICAgICAgICBleGNlcHQgU3RhbmRhcmRFcnJvcjoKICAgICAgICAgICAgcGFzcwoKICAgIGRlZiB0b3VjaGVkU3BheihzZWxmKToKICAgICAgICBzZWxmLm5vZGUyID0gYnMuZ2V0Q29sbGlzaW9uSW5mbygnb3Bwb3NpbmdOb2RlJykKCiAgICAgICAgZGVmIHNob2NrU3BheigpOgogICAgICAgICAgICBzZWxmLm5vZGUyLmdldERlbGVnYXRlKCkuc2hvY2soKQoKICAgICAgICBicy5nYW1lVGltZXIoNDAwLCBzaG9ja1NwYXopCgogICAgICAgIHNlbGYucyA9IHNlbGYubm9kZTIuZ2V0RGVsZWdhdGUoKS5fcHVuY2hQb3dlclNjYWxlCiAgICAgICAgc2VsZi5ub2RlMi5nZXREZWxlZ2F0ZSgpLl9wdW5jaFBvd2VyU2NhbGUgLT0gMC4zCgogICAgICAgIGJzLmdhbWVUaW1lcigyMDAwLCBicy5DYWxsKHNlbGYucmUpKQoKICAgICAgICBicy5wbGF5U291bmQoYnMuZ2V0U291bmQocmFuZG9tLmNob2ljZShbJ2VsZWN0cm8xJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VsZWN0cm8yJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VsZWN0cm8zJ10pKSkKCiAgICAgICAgc2VsZi5ub2RlMi5oYW5kbGVNZXNzYWdlKAogICAgICAgICAgICAnaW1wdWxzZScsIHNlbGYubm9kZTIucG9zaXRpb25bMF0sIHNlbGYubm9kZTIucG9zaXRpb25bMV0sCiAgICAgICAgICAgIHNlbGYubm9kZTIucG9zaXRpb25bMl0sIC1zZWxmLm5vZGUyLnZlbG9jaXR5WzBdLAogICAgICAgICAgICAtc2VsZi5ub2RlMi52ZWxvY2l0eVsxXSwgLXNlbGYubm9kZTIudmVsb2NpdHlbMl0sCiAgICAgICAgICAgIDIwMCwgMjAwLCAwLCAwLCAtc2VsZi5ub2RlMi52ZWxvY2l0eVswXSwKICAgICAgICAgICAgLXNlbGYubm9kZTIudmVsb2NpdHlbMV0sIC1zZWxmLm5vZGUyLnZlbG9jaXR5WzJdKQoKICAgICAgICBmbGFzaCA9IGJzLm5ld05vZGUoJ2ZsYXNoJywgYXR0cnM9ewogICAgICAgICAgICAncG9zaXRpb24nOiBzZWxmLm5vZGUyLnBvc2l0aW9uLAogICAgICAgICAgICAnc2l6ZSc6IDAuNywKICAgICAgICAgICAgJ2NvbG9yJzogKDAsIDAuNCtyYW5kb20ucmFuZG9tKCksIDEpfSkKCiAgICAgICAgZXhwbG9zaW9uID0gYnMubmV3Tm9kZSgnZXhwbG9zaW9uJywgYXR0cnM9ewogICAgICAgICAgICAncG9zaXRpb24nOiBzZWxmLm5vZGUyLnBvc2l0aW9uLAogICAgICAgICAgICAndmVsb2NpdHknOiAoc2VsZi5ub2RlMi52ZWxvY2l0eVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgIG1heCgtMS4wLCBzZWxmLm5vZGUyLnZlbG9jaXR5WzFdKSwKICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubm9kZTIudmVsb2NpdHlbMl0pLAogICAgICAgICAgICAncmFkaXVzJzogMC40LAogICAgICAgICAgICAnYmlnJzogVHJ1ZSwKICAgICAgICAgICAgJ2NvbG9yJzogKDAuMywgMC4zLCAxKX0pCgogICAgICAgIGJzLmdhbWVUaW1lcig0MDAsIGV4cGxvc2lvbi5kZWxldGUpCgogICAgICAgIGJzLmVtaXRCR0R5bmFtaWNzKAogICAgICAgICAgICBwb3NpdGlvbj1zZWxmLm5vZGUyLnBvc2l0aW9uLAogICAgICAgICAgICBjb3VudD0yMCwKICAgICAgICAgICAgc2NhbGU9MC41LAogICAgICAgICAgICBzcHJlYWQ9MC41LAogICAgICAgICAgICBjaHVua1R5cGU9J3NwYXJrJykKCiAgICAgICAgYnMuZ2FtZVRpbWVyKDYwLCBmbGFzaC5kZWxldGUpCgogICAgZGVmIHRvdWNoZWRPYmooc2VsZik6CiAgICAgICAgbm9kZSA9IGJzLmdldENvbGxpc2lvbkluZm8oJ29wcG9zaW5nTm9kZScpCiAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKHJhbmRvbS5jaG9pY2UoWydlbGVjdHJvMScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlbGVjdHJvMicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlbGVjdHJvMyddKSkpCgogICAgICAgIG5vZGUuaGFuZGxlTWVzc2FnZSgKICAgICAgICAgICAgJ2ltcHVsc2UnLCBub2RlLnBvc2l0aW9uWzBdK3JhbmRvbS51bmlmb3JtKC0yLCAyKSwKICAgICAgICAgICAgbm9kZS5wb3NpdGlvblsxXStyYW5kb20udW5pZm9ybSgtMiwgMiksCiAgICAgICAgICAgIG5vZGUucG9zaXRpb25bMl0rcmFuZG9tLnVuaWZvcm0oLTIsIDIpLAogICAgICAgICAgICAtbm9kZS52ZWxvY2l0eVswXStyYW5kb20udW5pZm9ybSgtMiwgMiksCiAgICAgICAgICAgIC1ub2RlLnZlbG9jaXR5WzFdK3JhbmRvbS51bmlmb3JtKC0yLCAyKSwKICAgICAgICAgICAgLW5vZGUudmVsb2NpdHlbMl0rcmFuZG9tLnVuaWZvcm0oLTIsIDIpLAogICAgICAgICAgICAxMDAsIDEwMCwgMCwgMCwgLW5vZGUudmVsb2NpdHlbMF0rcmFuZG9tLnVuaWZvcm0oLTIsIDIpLAogICAgICAgICAgICAtbm9kZS52ZWxvY2l0eVsxXStyYW5kb20udW5pZm9ybSgtMiwgMiksCiAgICAgICAgICAgIC1ub2RlLnZlbG9jaXR5WzJdK3JhbmRvbS51bmlmb3JtKC0yLCAyKSkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmbGFzaCA9IGJzLm5ld05vZGUoJ2ZsYXNoJywgYXR0cnM9ewogICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogbm9kZS5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICdzaXplJzogMC40LAogICAgICAgICAgICAgICAgJ2NvbG9yJzogKDAsIDAuNCtyYW5kb20ucmFuZG9tKCksIDEpfSkKICAgICAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBleHBsb3Npb24gPSBicy5uZXdOb2RlKCdleHBsb3Npb24nLCBhdHRycz17CiAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBub2RlLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgJ3ZlbG9jaXR5JzogKG5vZGUudmVsb2NpdHlbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4KC0xLjAsIG5vZGUudmVsb2NpdHlbMV0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUudmVsb2NpdHlbMl0pLAogICAgICAgICAgICAgICAgJ3JhZGl1cyc6IDAuNCwKICAgICAgICAgICAgICAgICdiaWcnOiBUcnVlLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogKDAuMywgMC4zLCAxKX0pCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICBwYXNzCgogICAgICAgIGJzLmdhbWVUaW1lcig0MDAsIGV4cGxvc2lvbi5kZWxldGUpCgogICAgICAgIGJzLmVtaXRCR0R5bmFtaWNzKAogICAgICAgICAgICBwb3NpdGlvbj1ub2RlLnBvc2l0aW9uLAogICAgICAgICAgICBjb3VudD0yMCwKICAgICAgICAgICAgc2NhbGU9MC41LAogICAgICAgICAgICBzcHJlYWQ9MC41LAogICAgICAgICAgICBjaHVua1R5cGU9J3NwYXJrJykKCiAgICAgICAgYnMuZ2FtZVRpbWVyKDYwLCBmbGFzaC5kZWxldGUpCgogICAgZGVmIGRlbGV0ZShzZWxmKToKICAgICAgICBzZWxmLm5vZGUuZGVsZXRlKCkKICAgICAgICBzZWxmLnZpc3VhbFJhZGl1cy5kZWxldGUoKQogICAgICAgIApjbGFzcyBjQ3ViZShicy5BY3Rvcik6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHBvc2l0aW9uPSgwLCAxLCAwKSwgdmVsb2NpdHk9KDAsIDAsIDApLAogICAgICAgICAgICAgICAgIGNvbXBhbmlvbj1GYWxzZSk6CiAgICAgICAgYnMuQWN0b3IuX19pbml0X18oc2VsZikKICAgICAgICBzZWxmLmNvbXBhbmlvbiA9IGNvbXBhbmlvbgogICAgICAgIHNlbGYubGlnaHQgPSBOb25lCiAgICAgICAgc2VsZi51cHRpbWVyID0gTm9uZQogICAgICAgIHNlbGYucGlja3VwZWQgPSBOb25lCiAgICAgICAgc2VsZi5yZWdlblRpbWVyID0gTm9uZQogICAgICAgIHNlbGYuY2hlY2tlclRpbWVyID0gTm9uZQoKICAgICAgICBmYWN0b3J5ID0gc2VsZi5nZXRGYWN0b3J5KCkKCiAgICAgICAgc2VsZi5jdWJlTWF0ZXJpYWwgPSBicy5NYXRlcmlhbCgpCiAgICAgICAgc2VsZi5jdWJlTWF0ZXJpYWwuYWRkQWN0aW9ucygKICAgICAgICAgICAgY29uZGl0aW9ucz0oKCd0aGV5SGF2ZU1hdGVyaWFsJywKICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnZGlydE1hdGVyaWFsJykpKSwKICAgICAgICAgICAgYWN0aW9ucz0oKCdjYWxsJywgJ2F0Q29ubmVjdCcsIHNlbGYuc2hpdEhpdHNUaGVDdWJlKSkpCgogICAgICAgIGlmIGNvbXBhbmlvbjoKICAgICAgICAgICAgc2VsZi5ub2RlID0gYnMubmV3Tm9kZSgncHJvcCcsIGRlbGVnYXRlPXNlbGYsIGF0dHJzPXsKICAgICAgICAgICAgICAgICdwb3NpdGlvbic6IHBvc2l0aW9uLAogICAgICAgICAgICAgICAgJ3ZlbG9jaXR5JzogdmVsb2NpdHksCiAgICAgICAgICAgICAgICAnbW9kZWwnOiBmYWN0b3J5LnRudE1vZGVsLAogICAgICAgICAgICAgICAgJ2xpZ2h0TW9kZWwnOiBmYWN0b3J5LnRudE1vZGVsLAogICAgICAgICAgICAgICAgJ2JvZHknOiAnY3JhdGUnLAogICAgICAgICAgICAgICAgJ3NoYWRvd1NpemUnOiAwLjUsCiAgICAgICAgICAgICAgICAnY29sb3JUZXh0dXJlJzogZmFjdG9yeS50bnRUZXgsCiAgICAgICAgICAgICAgICAncmVmbGVjdGlvbic6ICdzb2Z0JywKICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uU2NhbGUnOiBbMC4zXSwKICAgICAgICAgICAgICAgICdtYXRlcmlhbHMnOiAoYnMuZ2V0U2hhcmVkT2JqZWN0KCdvYmplY3RNYXRlcmlhbCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ2Zvb3RpbmdNYXRlcmlhbCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1YmVNYXRlcmlhbCl9KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYubm9kZSA9IGJzLm5ld05vZGUoJ3Byb3AnLCBkZWxlZ2F0ZT1zZWxmLCBhdHRycz17CiAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBwb3NpdGlvbiwKICAgICAgICAgICAgICAgICd2ZWxvY2l0eSc6IHZlbG9jaXR5LAogICAgICAgICAgICAgICAgJ21vZGVsJzogZmFjdG9yeS5jb21wYW5pb25DdWJlTW9kZWwsCiAgICAgICAgICAgICAgICAnbGlnaHRNb2RlbCc6IGZhY3RvcnkuY29tcGFuaW9uQ3ViZU1vZGVsLAogICAgICAgICAgICAgICAgJ2JvZHknOiAnY3JhdGUnLAogICAgICAgICAgICAgICAgJ3NoYWRvd1NpemUnOiAwLjUsCiAgICAgICAgICAgICAgICAnY29sb3JUZXh0dXJlJzogZmFjdG9yeS53ZWlnaHRDdWJlVGV4LAogICAgICAgICAgICAgICAgJ3JlZmxlY3Rpb24nOiAnc29mdCcsCiAgICAgICAgICAgICAgICAncmVmbGVjdGlvblNjYWxlJzogWzAuM10sCiAgICAgICAgICAgICAgICAnbWF0ZXJpYWxzJzogKGJzLmdldFNoYXJlZE9iamVjdCgnb2JqZWN0TWF0ZXJpYWwnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdmb290aW5nTWF0ZXJpYWwnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdWJlTWF0ZXJpYWwpfSkKCiAgICAgICAgZGVmIHRleHRTZW5kZXIoKToKICAgICAgICAgICAgaWYgc2VsZi5ub2RlLmV4aXN0cygpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5jb21wYW5pb24gYW5kIHNlbGYucGlja3VwZWQgXAogICAgICAgICAgICAgICAgICAgICAgICBhbmQgYnNJbnRlcm5hbC5fZ2V0Rm9yZWdyb3VuZEhvc3RTZXNzaW9uKCkubmFya29tb2RlOgogICAgICAgICAgICAgICAgICAgIGJzVXRpbHMuUG9wdXBUZXh0KAogICAgICAgICAgICAgICAgICAgICAgICByYW5kb20uY2hvaWNlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJIGxvdmUgeW91JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdIaScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSG93IGFyZSB5b3U/JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJIGFtIGFsaXZlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdOb3cgeW91IGNhbiBoZWFyIG1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdEb250IGZvcmdldCBtZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQm9tYkRhc2ggZm9yZXZlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnTmFtYSBjb21lIGJhY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0RvIHlvdSBrbm93IENoZWxsPycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnR0xhRE9TIGtpbGwgbXkgYnJvdGhlcnMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1BMRUFTRSBET05UIEZJUkUgTUUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0VyaWMgYnJpbmcgYmFjayB0aGUgbGlnaHQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1RoZSBjYWtlIGlzIGEgbGllJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJZiBsaWZlIGdpdmVzIHlvdSBsZW1vbnNcbmRvbnQgbWFrZSB0aGUgbGVtb25hZGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzA5IFRhcnRhcm9zJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQcm9tZXRoZXVzJ10pLAogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj0oMSwgMC4xLCAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9MC44LAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj1zZWxmLm5vZGUucG9zaXRpb24pLmF1dG9SZXRhaW4oKQoKICAgICAgICBicy5nYW1lVGltZXIoMjAwMCtyYW5kb20ucmFuZGludCgwLCAzMDAwKSwgdGV4dFNlbmRlciwgcmVwZWF0PVRydWUpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgZ2V0RmFjdG9yeShjbHMpOgogICAgICAgIGFjdGl2aXR5ID0gYnMuZ2V0QWN0aXZpdHkoKQogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIGFjdGl2aXR5Ll9zaGFyZWRQb3J0YWxGYWN0b3J5CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZiA9IGFjdGl2aXR5Ll9zaGFyZWRQb3J0YWxGYWN0b3J5ID0gUG9ydGFsRmFjdG9yeSgpCiAgICAgICAgICAgIHJldHVybiBmCgogICAgZGVmIHNoaXRIaXRzVGhlQ3ViZShzZWxmKToKICAgICAgICBub2RlID0gYnMuZ2V0Q29sbGlzaW9uSW5mbygnb3Bwb3NpbmdOb2RlJykKICAgICAgICBicy5lbWl0QkdEeW5hbWljcygKICAgICAgICAgICAgcG9zaXRpb249bm9kZS5wb3NpdGlvbiwKICAgICAgICAgICAgY291bnQ9MzAsCiAgICAgICAgICAgIHNjYWxlPTEuMywKICAgICAgICAgICAgc3ByZWFkPTAuMSwKICAgICAgICAgICAgY2h1bmtUeXBlPSdzd2VhdCcpCgogICAgICAgIG5vZGUuaGFuZGxlTWVzc2FnZShicy5EaWVNZXNzYWdlKCkpCgogICAgZGVmIGhhbmRsZU1lc3NhZ2Uoc2VsZiwgbSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShtLCBicy5EaWVNZXNzYWdlKToKICAgICAgICAgICAgaWYgc2VsZi5ub2RlLmV4aXN0cygpOgogICAgICAgICAgICAgICAgc2VsZi5ub2RlLmRlbGV0ZSgpCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShtLCBicy5PdXRPZkJvdW5kc01lc3NhZ2UpOgogICAgICAgICAgICBpZiBzZWxmLm5vZGUuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICBzZWxmLm5vZGUuZGVsZXRlKCkKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIGJzLlBpY2tlZFVwTWVzc2FnZSk6CiAgICAgICAgICAgIHNlbGYucGlja3VwZWQgPSBUcnVlCiAgICAgICAgICAgIHNlbGYubm9kZS5leHRyYUFjY2VsZXJhdGlvbiA9ICgwLCAyNSwgMCkKCiAgICAgICAgICAgIGRlZiB1cCgpOgogICAgICAgICAgICAgICAgc2VsZi5ub2RlLmV4dHJhQWNjZWxlcmF0aW9uID0gKDAsIDQwLCAwKQoKICAgICAgICAgICAgc2VsZi51cHRpbWVyID0gYnMuVGltZXIoMzMwLCB1cCkKCiAgICAgICAgICAgIGRlZiBjaGVja2VyKCk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLm5vZGUuZXhpc3RzKCkgYW5kIFwKICAgICAgICAgICAgICAgICAgICAgICAgKG0gaXMgTm9uZSBvciBub3QgbS5ub2RlLmV4aXN0cygpCiAgICAgICAgICAgICAgICAgICAgICAgICBvciBtLm5vZGUuaG9sZE5vZGUgIT0gc2VsZi5ub2RlKToKICAgICAgICAgICAgICAgICAgICBzZWxmLm5vZGUuZXh0cmFBY2NlbGVyYXRpb24gPSAoMCwgMCwgMCkKICAgICAgICAgICAgICAgICAgICBzZWxmLnBpY2t1cGVkID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBzZWxmLmNoZWNrZXJUaW1lciA9IE5vbmUKCiAgICAgICAgICAgIHNlbGYuY2hlY2tlclRpbWVyID0gYnMuZ2FtZVRpbWVyKDEwMCwgY2hlY2tlciwgcmVwZWF0PVRydWUpCiAgICAgICAgICAgIHNlbGYuc3Bhek5vZGUgPSBtLm5vZGUKICAgICAgICAgICAgZGVsZWdhdGUgPSBtLm5vZGUuZ2V0RGVsZWdhdGUoKQoKICAgICAgICAgICAgc2VsZi5saWdodCA9IGJzLm5ld05vZGUoJ2xpZ2h0JywgYXR0cnM9ewogICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogc2VsZi5ub2RlLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogKDAsIDEsIDApLAogICAgICAgICAgICAgICAgJ3ZvbHVtZUludGVuc2l0eVNjYWxlJzogMS4wLAogICAgICAgICAgICAgICAgJ2ludGVuc2l0eSc6IDAuMSwKICAgICAgICAgICAgICAgICdyYWRpdXMnOiAwLjZ9KQoKICAgICAgICAgICAgbS5ub2RlLmNvbm5lY3RBdHRyKCdwb3NpdGlvbicsIHNlbGYubGlnaHQsICdwb3NpdGlvbicpCgogICAgICAgICAgICBkZWYgcmVnZW4oKToKICAgICAgICAgICAgICAgIGlmIG0gaXMgbm90IE5vbmUgYW5kIG0ubm9kZS5leGlzdHMoKSBcCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBtLm5vZGUuZ2V0RGVsZWdhdGUoKS5oaXRQb2ludHMgXAogICAgICAgICAgICAgICAgICAgICAgICA8IG0ubm9kZS5nZXREZWxlZ2F0ZSgpLmhpdFBvaW50c01heCBcCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBzZWxmLnBpY2t1cGVkOgogICAgICAgICAgICAgICAgICAgIGRlbGVnYXRlLmhpdFBvaW50cyArPSAxCiAgICAgICAgICAgICAgICAgICAgZGVsZWdhdGUuX2xhc3RIaXRUaW1lID0gTm9uZQogICAgICAgICAgICAgICAgICAgIGRlbGVnYXRlLl9udW1UaW1lc0hpdCA9IDAKICAgICAgICAgICAgICAgICAgICBtLm5vZGUuaHVydCAtPSAwLjAwMQogICAgICAgICAgICAgICAgICAgIGJzLmVtaXRCR0R5bmFtaWNzKAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj1tLm5vZGUucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5PSgwLCAzLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ9aW50KDMuMCtyYW5kb20ucmFuZG9tKCkqNSksCiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPTEuNSwKICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkPTAuMywKICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtUeXBlPSdzd2VhdCcpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYubGlnaHQgaXMgbm90IE5vbmUgYW5kIHNlbGYubGlnaHQuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubGlnaHQuZGVsZXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yZWdlblRpbWVyID0gTm9uZQoKICAgICAgICAgICAgc2VsZi5yZWdlblRpbWVyID0gYnMuVGltZXIoMTAsIHJlZ2VuLCByZXBlYXQ9VHJ1ZSkKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIGJzLkRyb3BwZWRNZXNzYWdlKToKICAgICAgICAgICAgc2VsZi5waWNrdXBlZCA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYudXB0aW1lciA9IE5vbmUKICAgICAgICAgICAgc2VsZi5zcGF6Tm9kZSA9IE5vbmUKICAgICAgICAgICAgc2VsZi5yZWdlblRpbWVyID0gTm9uZQogICAgICAgICAgICBzZWxmLmNoZWNrZXJUaW1lciA9IE5vbmUKICAgICAgICAgICAgc2VsZi5ub2RlLmV4dHJhQWNjZWxlcmF0aW9uID0gKDAsIDAsIDApCiAgICAgICAgICAgIGlmIHNlbGYubGlnaHQgaXMgbm90IE5vbmUgYW5kIHNlbGYubGlnaHQuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICBzZWxmLmxpZ2h0LmRlbGV0ZSgpCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShtLCBicy5IaXRNZXNzYWdlKToKICAgICAgICAgICAgc2VsZi5ub2RlLmhhbmRsZU1lc3NhZ2UoCiAgICAgICAgICAgICAgICAnaW1wdWxzZScsIG0ucG9zWzBdLCBtLnBvc1sxXSwgbS5wb3NbMl0sCiAgICAgICAgICAgICAgICBtLnZlbG9jaXR5WzBdLCBtLnZlbG9jaXR5WzFdLCBtLnZlbG9jaXR5WzJdLAogICAgICAgICAgICAgICAgbS5tYWduaXR1ZGUsIG0udmVsb2NpdHlNYWduaXR1ZGUsIG0ucmFkaXVzLAogICAgICAgICAgICAgICAgMCwgbS52ZWxvY2l0eVswXSwgbS52ZWxvY2l0eVsxXSwgbS52ZWxvY2l0eVsyXSkKICAgICAgICAgICAgCmNsYXNzIEltcGFjdE1lc3NhZ2Uob2JqZWN0KToKICAgIHBhc3MKICAgICAgICAgICAgCmNsYXNzIE1hZ2ljU3BlbGwoYnMuQWN0b3IpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwb3NpdGlvbj0oMCwgMTAsIDApLCB2ZWxvY2l0eT0oMCwgMCwgMCksIG93bmVyPU5vbmUpOgogICAgICAgIGJzLkFjdG9yLl9faW5pdF9fKHNlbGYpCiAgICAgICAgc2VsZi5vd25lciA9IG93bmVyCiAgICAgICAgc2VsZi5wb3NpdGlvbiA9IHBvc2l0aW9uCiAgICAgICAgc2VsZi52ZWxvY2l0eSA9IHZlbG9jaXR5CiAgICAgICAgc2VsZi5sYXN0SnVtcFRpbWUgPSAtOTk5OQogICAgICAgIHNlbGYuX2p1bXBDb29sZG93biA9IDI1MAogICAgICAgIHNlbGYubSA9IE5vbmUKICAgICAgICBzZWxmLnggPSBOb25lCiAgICAgICAgc2VsZi55ID0gTm9uZQogICAgICAgIHNlbGYueiA9IE5vbmUKICAgICAgICBzZWxmLnMgPSAwCiAgICAgICAgc2VsZi5yID0gMC4yCiAgICAgICAgc2VsZi5pc0l0U3BheiA9IEZhbHNlCiAgICAgICAgc2VsZi5tYXhSID0gMC4yCiAgICAgICAgc2VsZi5yZXZlcnMgPSBGYWxzZQogICAgICAgIHNlbGYub2ZmID0gRmFsc2UKCiAgICAgICAgc2VsZi5pbXBhY3RCbGFzdE1hdGVyaWFsID0gYnMuTWF0ZXJpYWwoKQogICAgICAgIHNlbGYuaW1wYWN0Qmxhc3RNYXRlcmlhbC5hZGRBY3Rpb25zKAogICAgICAgICAgICBjb25kaXRpb25zPSgoJ3dlQXJlT2xkZXJUaGFuJywgMjAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCcsICgndGhleUFyZU9sZGVyVGhhbicsIDIwMCksCiAgICAgICAgICAgICAgICAgICAgICAgICdhbmQnLCAoJ2V2YWxDb2xsaWRpbmcnLCksCiAgICAgICAgICAgICAgICAgICAgICAgICdhbmQnLCAoKCd0aGV5SGF2ZU1hdGVyaWFsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdmb290aW5nTWF0ZXJpYWwnKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29yJywgKCd0aGV5SGF2ZU1hdGVyaWFsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMuZ2V0U2hhcmVkT2JqZWN0KCdvYmplY3RNYXRlcmlhbCcpKSkpLAogICAgICAgICAgICBhY3Rpb25zPSgoJ21lc3NhZ2UnLCAnb3VyTm9kZScsICdhdENvbm5lY3QnLCBJbXBhY3RNZXNzYWdlKCkpKSkKICAgICAgICAKICAgICAgICBzZWxmLmltcGFjdEJsYXN0TWF0ZXJpYWw9YnMuTWF0ZXJpYWwoKSAgICAgICAgCiAgICAgICAgc2VsZi5pbXBhY3RCbGFzdE1hdGVyaWFsLmFkZEFjdGlvbnMoCiAgICAgICAgICAgIGNvbmRpdGlvbnM9KCgoJ3RoZXlBcmVPbGRlclRoYW4nLCAxMDApLAogICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCcsICgndGhleUhhdmVNYXRlcmlhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgncGxheWVyTWF0ZXJpYWwnKSkpKSwKICAgICAgICAgICAgYWN0aW9ucz0oJ21lc3NhZ2UnLCAndGhlaXJOb2RlJywnYXRDb25uZWN0JywgYnMuUG93ZXJ1cE1lc3NhZ2UoJ3Bvd2VydXAnKSkpCgogICAgICAgIHNlbGYubm9kZSA9IGJzLm5ld05vZGUoJ3Byb3AnLCBkZWxlZ2F0ZT1zZWxmLCBhdHRycz17CiAgICAgICAgICAgICdwb3NpdGlvbic6IHNlbGYucG9zaXRpb24sCiAgICAgICAgICAgICdtb2RlbCc6IGJzLmdldE1vZGVsKCdpbXBhY3RCb21iJyksCiAgICAgICAgICAgICdsaWdodE1vZGVsJzogYnMuZ2V0TW9kZWwoJ2ltcGFjdEJvbWInKSwKICAgICAgICAgICAgJ2JvZHknOiAnY2Fwc3VsZScsCiAgICAgICAgICAgICd2ZWxvY2l0eSc6IHNlbGYudmVsb2NpdHksCiAgICAgICAgICAgICdtb2RlbFNjYWxlJzogMC42LAogICAgICAgICAgICAnYm9keVNjYWxlJzogMC45LAogICAgICAgICAgICAnc2hhZG93U2l6ZSc6IDAuMSwKICAgICAgICAgICAgJ3JlZmxlY3Rpb24nOiAnc29mdCcsCiAgICAgICAgICAgICdyZWZsZWN0aW9uU2NhbGUnOiBbMi4wXSwKICAgICAgICAgICAgJ2V4dHJhQWNjZWxlcmF0aW9uJzogKDAsIDE4LCAwKSwKICAgICAgICAgICAgJ2NvbG9yVGV4dHVyZSc6IGJzLmdldFRleHR1cmUoJ2xhdmEnKSwKICAgICAgICAgICAgJ21hdGVyaWFscyc6IChicy5nZXRTaGFyZWRPYmplY3QoJ2Zvb3RpbmdNYXRlcmlhbCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgIGJzLmdldFNoYXJlZE9iamVjdCgnb2JqZWN0TWF0ZXJpYWwnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmltcGFjdEJsYXN0TWF0ZXJpYWwpfSkKCiAgICAgICAgc2VsZi5saWdodE5vZGUgPSBicy5uZXdOb2RlKCdsaWdodCcsIGF0dHJzPXsKICAgICAgICAgICAgJ3Bvc2l0aW9uJzogc2VsZi5wb3NpdGlvbiwKICAgICAgICAgICAgJ2NvbG9yJzogKDEsIDAuOCwgMCksCiAgICAgICAgICAgICdyYWRpdXMnOiAwLjEsCiAgICAgICAgICAgICd2b2x1bWVJbnRlbnNpdHlTY2FsZSc6IDE1LjB9KQoKICAgICAgICBzZWxmLm5vZGUuY29ubmVjdEF0dHIoJ3Bvc2l0aW9uJywgc2VsZi5saWdodE5vZGUsICdwb3NpdGlvbicpCiAgICAgICAgc2VsZi5fZW1pdCA9IGJzLlRpbWVyKDE1LCBicy5XZWFrQ2FsbChzZWxmLmVtaXQpLCByZXBlYXQ9VHJ1ZSkKICAgICAgICBzZWxmLl9lbWl0MSA9IGJzLlRpbWVyKDM1LCBicy5XZWFrQ2FsbChzZWxmLnNwYXduUGFydGljbGVzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdD1UcnVlKQoKICAgICAgICAKCiAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKCdzcGVsbCcpKQoKICAgIGRlZiBzcGF3blBhcnRpY2xlcyhzZWxmKToKICAgICAgICBzZWxmLnggPSBzZWxmLm5vZGUucG9zaXRpb25bMF0KICAgICAgICBzZWxmLnkgPSBzZWxmLm5vZGUucG9zaXRpb25bMV0KICAgICAgICBzZWxmLnogPSBzZWxmLm5vZGUucG9zaXRpb25bMl0KICAgICAgICBzaW4gPSBtYXRoLnNpbihzZWxmLnMpICogc2VsZi5yCiAgICAgICAgY29zID0gbWF0aC5jb3Moc2VsZi5zKSAqIHNlbGYucgogICAgICAgIHNlbGYucyArPSAwLjQKCiAgICAgICAgaWYgc2VsZi5yIDwgMDoKICAgICAgICAgICAgc2VsZi5yZXZlcnMgPSBUcnVlCiAgICAgICAgZWxpZiBzZWxmLnIgPiBzZWxmLm1heFI6CiAgICAgICAgICAgIHNlbGYucmV2ZXJzID0gRmFsc2UKCiAgICAgICAgYnMuZW1pdEJHRHluYW1pY3MoCiAgICAgICAgICAgIHBvc2l0aW9uPShzZWxmLngrY29zLCBzZWxmLnksIHNlbGYueitzaW4pLAogICAgICAgICAgICB2ZWxvY2l0eT0oMCwgMCwgMCksCiAgICAgICAgICAgIGNvdW50PTUsCiAgICAgICAgICAgIHNjYWxlPTAuNCwKICAgICAgICAgICAgc3ByZWFkPTAsCiAgICAgICAgICAgIGNodW5rVHlwZT0nc3BhcmsnKQoKICAgIGRlZiBlbWl0KHNlbGYpOgogICAgICAgIGJzLmVtaXRCR0R5bmFtaWNzKAogICAgICAgICAgICBwb3NpdGlvbj1zZWxmLm5vZGUucG9zaXRpb24sCiAgICAgICAgICAgIHZlbG9jaXR5PXNlbGYubm9kZS52ZWxvY2l0eSwKICAgICAgICAgICAgY291bnQ9MTAsCiAgICAgICAgICAgIHNjYWxlPTAuNCwKICAgICAgICAgICAgc3ByZWFkPTAuMDEsCiAgICAgICAgICAgIGNodW5rVHlwZT0nc3BhcmsnKQoKICAgIGRlZiBpbXBhY3RTcGF6KHNlbGYpOgogICAgICAgIG5vZGUgPSBicy5nZXRDb2xsaXNpb25JbmZvKCdvcHBvc2luZ05vZGUnKQogICAgICAgIGlmIG5vZGUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZS5nZXREZWxlZ2F0ZSgpLCBicy5TcGF6KToKICAgICAgICAgICAgICAgIHNlbGYubm9kZS5oYW5kbGVNZXNzYWdlKGJzLkRpZU1lc3NhZ2UoKSkKCiAgICAgICAgICAgICAgICBkZWYgc2V0U3BlZWQodmFsKToKICAgICAgICAgICAgICAgICAgICBpZiBub2RlLmV4aXN0cygpOgogICAgICAgICAgICAgICAgICAgICAgICBzZXRhdHRyKG5vZGUsICdob2NrZXknLCB2YWwpCgogICAgICAgICAgICAgICAgc2V0U3BlZWQoVHJ1ZSkKCiAgICAgICAgICAgICAgICBzZWxmLnNoaWVsZCA9IGJzLm5ld05vZGUoJ3Njb3JjaCcsIG93bmVyPW5vZGUsIGF0dHJzPXsKICAgICAgICAgICAgICAgICAgICAnY29sb3InOiAocmFuZG9tLnJhbmRvbSgpKjIwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb20ucmFuZG9tKCkqMjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbS5yYW5kb20oKSoyMCksCiAgICAgICAgICAgICAgICAgICAgJ3NpemUnOiAwLjR9KQoKICAgICAgICAgICAgICAgIGJzLmFuaW1hdGUoc2VsZi5zaGllbGQsICdzaXplJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgezA6IDEsIDc2MDogMC40LCAxNTIwOiAxfSwgbG9vcD1UcnVlKQoKICAgICAgICAgICAgICAgIGJzLmFuaW1hdGUoc2VsZi5zaGllbGQsICdwcmVzZW5jZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHswOiAxLCAyNjA6IDAuNCwgNTIwOiAxfSwgbG9vcD1UcnVlKQoKICAgICAgICAgICAgICAgIG5vZGUuY29ubmVjdEF0dHIoJ3Bvc2l0aW9uQ2VudGVyJywgc2VsZi5zaGllbGQsICdwb3NpdGlvbicpCgogICAgICAgICAgICAgICAgc2VsZi5zaGllbGQxID0gYnMubmV3Tm9kZSgnc2NvcmNoJywgb3duZXI9bm9kZSwgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICdjb2xvcic6IChyYW5kb20ucmFuZG9tKCkqMjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbS5yYW5kb20oKSoyMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tLnJhbmRvbSgpKjIwKSwKICAgICAgICAgICAgICAgICAgICAnc2l6ZSc6IDAuNH0pCgogICAgICAgICAgICAgICAgYnMuYW5pbWF0ZShzZWxmLnNoaWVsZDEsICdzaXplJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgezA6IDAuNywgMzgwOiAwLjQsIDc2MDogMC43LCAxNDQwOiAxLCAxNTIwOiAwLjd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICBsb29wPVRydWUpCgogICAgICAgICAgICAgICAgYnMuYW5pbWF0ZShzZWxmLnNoaWVsZDEsICdwcmVzZW5jZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHswOiAwLjcsIDEzMDogMC40LCAyNjA6IDAuNywgMzkwOiAxLCA1MjA6IDAuN30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3A9VHJ1ZSkKCiAgICAgICAgICAgICAgICBub2RlLmNvbm5lY3RBdHRyKCdwb3NpdGlvbkNlbnRlcicsIHNlbGYuc2hpZWxkMSwgJ3Bvc2l0aW9uJykKCiAgICAgICAgICAgICAgICBzZWxmLnNoaWVsZDIgPSBicy5uZXdOb2RlKCdzY29yY2gnLCBvd25lcj1ub2RlLCBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgJ2NvbG9yJzogKHJhbmRvbS5yYW5kb20oKSoyMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tLnJhbmRvbSgpKjIwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb20ucmFuZG9tKCkqMjApLAogICAgICAgICAgICAgICAgICAgICdzaXplJzogMC40fSkKCiAgICAgICAgICAgICAgICBicy5hbmltYXRlKHNlbGYuc2hpZWxkMiwgJ3NpemUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICB7MDogMC40LCAzODA6IDAuNywgNzYwOiAxLCAxNDQwOiAwLjcsIDE1MjA6IDAuNH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3A9VHJ1ZSkKCiAgICAgICAgICAgICAgICBicy5hbmltYXRlKHNlbGYuc2hpZWxkMiwgJ3ByZXNlbmNlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgezA6IDAuNCwgMTMwOiAwLjcsIDI2MDogMSwgMzkwOiAwLjcsIDUyMDogMC40fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9vcD1UcnVlKQoKICAgICAgICAgICAgICAgIG5vZGUuY29ubmVjdEF0dHIoJ3Bvc2l0aW9uQ2VudGVyJywgc2VsZi5zaGllbGQyLCAncG9zaXRpb24nKQoKICAgICAgICAgICAgICAgIGRlZiBvbkp1bXBQcmVzc1NwZWMoKToKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgbm9kZS5leGlzdHMoKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICAgICAgICAgIHQgPSBicy5nZXRHYW1lVGltZSgpCiAgICAgICAgICAgICAgICAgICAgaWYgdCAtIHNlbGYubGFzdEp1bXBUaW1lID49IHNlbGYuX2p1bXBDb29sZG93biBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQgbm90IHNlbGYub2ZmIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBub3QgKG5vZGUua25vY2tvdXQgPiAwLjAgb3Igbm9kZS5mcm96ZW4gPiAwKToKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5qdW1wUHJlc3NlZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sYXN0SnVtcFRpbWUgPSB0CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2p1bXBDb29sZG93biA9IDc1MAogICAgICAgICAgICAgICAgICAgICAgICBub2RlLmhhbmRsZU1lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW1wdWxzZScsIG5vZGUucG9zaXRpb25bMF0sIG5vZGUucG9zaXRpb25bMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnBvc2l0aW9uWzJdLCAwLCAwLCAwLCAyMDAsIDIwMCwgMCwgMCwgMCwgMSwgMCkKCiAgICAgICAgICAgICAgICBub2RlLmdldERlbGVnYXRlKCkuZ2V0UGxheWVyKCkuYXNzaWduSW5wdXRDYWxsKAogICAgICAgICAgICAgICAgICAgICdqdW1wUHJlc3MnLCBvbkp1bXBQcmVzc1NwZWMpCgogICAgICAgICAgICAgICAgaWYgbm9kZSBpcyBub3QgTm9uZSBhbmQgbm9kZS5leGlzdHMoKToKICAgICAgICAgICAgICAgICAgICBub2RlLmdldERlbGVnYXRlKCkuc3VwZXJIZWFsdGgoVHJ1ZSkKCiAgICAgICAgICAgICAgICBkZWYgc3BhekVtaXQoKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGJzLmVtaXRCR0R5bmFtaWNzKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb249KG5vZGUucG9zaXRpb25bMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5wb3NpdGlvblsxXS0wLjMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5wb3NpdGlvblsyXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWxvY2l0eT1ub2RlLnZlbG9jaXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ9MTUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT0wLjQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHJlYWQ9MC4wMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rVHlwZT0nc3BhcmsnKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAgICAgICAgIHNlbGYuc3Bhel9lbWl0ID0gYnMuVGltZXIoMTUsIGJzLkNhbGwoc3BhekVtaXQpLCByZXBlYXQ9VHJ1ZSkKCiAgICAgICAgICAgICAgICBkZWYgb2ZmQWxsRWZmZWN0cygpOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2hpZWxkLmRlbGV0ZSgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaGllbGQgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaGllbGQxLmRlbGV0ZSgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaGllbGQxID0gTm9uZQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2hpZWxkMi5kZWxldGUoKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2hpZWxkMiA9IE5vbmUKICAgICAgICAgICAgICAgICAgICBzZWxmLm9mZiA9IFRydWUKICAgICAgICAgICAgICAgICAgICBzZWxmLnNwYXpfZW1pdCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICBzZXRTcGVlZChGYWxzZSkKICAgICAgICAgICAgICAgICAgICBpZiBub2RlIGlzIG5vdCBOb25lIGFuZCBub2RlLmV4aXN0cygpOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLmdldERlbGVnYXRlKCkuY29ubmVjdENvbnRyb2xzVG9QbGF5ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5nZXREZWxlZ2F0ZSgpLnN1cGVySGVhbHRoKEZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgYnMuZ2FtZVRpbWVyKDE1MDAwLCBicy5DYWxsKG9mZkFsbEVmZmVjdHMpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5ub2RlLmhhbmRsZU1lc3NhZ2UoYnMuRGllTWVzc2FnZSgpKQoKICAgIGRlZiBoYW5kbGVNZXNzYWdlKHNlbGYsIG0pOgogICAgICAgIGlmIGlzaW5zdGFuY2UobSwgYnMuRGllTWVzc2FnZSk6CiAgICAgICAgICAgIGlmIHNlbGYubm9kZS5leGlzdHMoKToKICAgICAgICAgICAgICAgIHNlbGYubm9kZS5kZWxldGUoKQogICAgICAgICAgICAgICAgc2VsZi5saWdodE5vZGUuZGVsZXRlKCkKICAgICAgICAgICAgICAgIHNlbGYuX2VtaXQgPSBOb25lCiAgICAgICAgICAgICAgICBzZWxmLl9lbWl0MSA9IE5vbmUKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIGJzLk91dE9mQm91bmRzTWVzc2FnZSk6CiAgICAgICAgICAgIHNlbGYubm9kZS5oYW5kbGVNZXNzYWdlKGJzLkRpZU1lc3NhZ2UoKSkKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIGJzLkhpdE1lc3NhZ2UpOgogICAgICAgICAgICBzZWxmLm5vZGUuaGFuZGxlTWVzc2FnZShicy5EaWVNZXNzYWdlKCkpCiAgICAgICAgICAgIApjbGFzcyBBcnRpbGxlcnkob2JqZWN0KToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgcG9zaXRpb249KDAsIDEsIDApLCB0YXJnZXQ9Tm9uZSwKICAgICAgICAgICAgICAgICBvd25lcj1Ob25lLCBib21iVHlwZT0naW1wYWN0Jywgc291cmNlUGxheWVyPU5vbmUpOgogICAgICAgIHNlbGYucG9zaXRpb24gPSBwb3NpdGlvbgogICAgICAgIHNlbGYub3duZXIgPSBvd25lcgogICAgICAgIHNlbGYudGFyZ2V0ID0gdGFyZ2V0CiAgICAgICAgc2VsZi5ib21iVHlwZSA9IGJvbWJUeXBlCiAgICAgICAgc2VsZi5zb3VyY2VQbGF5ZXIgPSBzb3VyY2VQbGF5ZXIKICAgICAgICBzZWxmLnJhZGl1cyA9IDYwCiAgICAgICAgc2VsZi5tYXhIZWlnaHQgPSBicy5nZXRBY3Rpdml0eSgpLmdldE1hcCgpLmdldERlZkJvdW5kQm94KAogICAgICAgICAgICAnbGV2ZWxCb3VuZHMnKQoKICAgICAgICBzZWxmLmFpbVpvbmUgPSBicy5NYXRlcmlhbCgpCiAgICAgICAgc2VsZi5haW1ab25lLmFkZEFjdGlvbnMoCiAgICAgICAgICAgIGNvbmRpdGlvbnM9KCgndGhleUhhdmVNYXRlcmlhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICBicy5nZXRTaGFyZWRPYmplY3QoJ3BsYXllck1hdGVyaWFsJykpKSwKICAgICAgICAgICAgYWN0aW9ucz0oKCdtb2RpZnlQYXJ0Q29sbGlzaW9uJywgJ2NvbGxpZGUnLCBUcnVlKSwKICAgICAgICAgICAgICAgICAgICAgKCdtb2RpZnlQYXJ0Q29sbGlzaW9uJywgJ3BoeXNpY2FsJywgRmFsc2UpLAogICAgICAgICAgICAgICAgICAgICAoJ2NhbGwnLCAnYXRDb25uZWN0Jywgc2VsZi50b3VjaGVkU3BheikpKQoKICAgICAgICBzZWxmLm5vZGUgPSBicy5uZXdOb2RlKCdyZWdpb24nLCBhdHRycz17CiAgICAgICAgICAgICdwb3NpdGlvbic6IHNlbGYucG9zaXRpb24sCiAgICAgICAgICAgICdzY2FsZSc6ICgwLjUsIDAuNSwgMC41KSwKICAgICAgICAgICAgJ3R5cGUnOiAnc3BoZXJlJywKICAgICAgICAgICAgJ21hdGVyaWFscyc6IFtzZWxmLmFpbVpvbmVdfSkKCiAgICAgICAgc2NhbGUgPSB7CiAgICAgICAgICAgIDA6ICgwLjUsIDAuNSwgMC41KSwKICAgICAgICAgICAgMTAwOiAoc2VsZi5yYWRpdXMsIHNlbGYucmFkaXVzLCBzZWxmLnJhZGl1cykKICAgICAgICB9CgogICAgICAgIGJzLmFuaW1hdGVBcnJheShzZWxmLm5vZGUsICdzY2FsZScsIDMsIHNjYWxlKQoKICAgICAgICBicy5nYW1lVGltZXIoMTAxLCBzZWxmLm5vZGUuZGVsZXRlKQogICAgICAgIGJzLmdhbWVUaW1lcigxMDIsIHNlbGYuc3RyaWtlKQoKICAgIGRlZiB0b3VjaGVkU3BheihzZWxmKToKICAgICAgICBub2RlID0gYnMuZ2V0Q29sbGlzaW9uSW5mbygnb3Bwb3NpbmdOb2RlJykKICAgICAgICBpZiBzZWxmLm93bmVyIGlzIG5vdCBOb25lOgogICAgICAgICAgICBpZiBub3Qgbm9kZSA9PSBzZWxmLm93bmVyOgogICAgICAgICAgICAgICAgc2VsZi50YXJnZXQgPSBub2RlCiAgICAgICAgICAgICAgICBzZWxmLm5vZGUubWF0ZXJpYWxzID0gW2JzLk1hdGVyaWFsKCldCiAgICAgICAgICAgICAgICBicy5nYW1lVGltZXIoMzAwLCBzZWxmLm5vZGUuZGVsZXRlKQoKICAgIGRlZiBzdHJpa2Uoc2VsZik6CiAgICAgICAgaWYgc2VsZi50YXJnZXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGRlZiBsYXVuY2hCb21iKCk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLnRhcmdldCBpcyBub3QgTm9uZSBhbmQgc2VsZi50YXJnZXQuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3MgPSBzZWxmLnRhcmdldC5wb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIGIgPSBicy5Cb21iKAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj1zZWxmLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICB2ZWxvY2l0eT0oMCwgNSwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgIGJvbWJUeXBlPXNlbGYuYm9tYlR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hcGFsbT1UcnVlKS5hdXRvUmV0YWluKCkKCiAgICAgICAgICAgICAgICAgICAgYi5ub2RlLmV4dHJhQWNjZWxlcmF0aW9uID0gKDAsIDcwMCwgMCkKICAgICAgICAgICAgICAgICAgICBiLm5vZGUudmVsb2NpdHkgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgIGIubm9kZS52ZWxvY2l0eVswXSsoc2VsZi5wb3NbMF0tYi5ub2RlLnBvc2l0aW9uWzBdKSwKICAgICAgICAgICAgICAgICAgICAgICAgMTAsCiAgICAgICAgICAgICAgICAgICAgICAgIGIubm9kZS52ZWxvY2l0eVsyXSsoc2VsZi5wb3NbMl0tYi5ub2RlLnBvc2l0aW9uWzJdKSkKCiAgICAgICAgICAgICAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKCdBaW0nKSkKCiAgICAgICAgICAgIGJzLmdhbWVUaW1lcigxMDAsIGJzLkNhbGwobGF1bmNoQm9tYikpCiAgICAgICAgICAgIGJzLmdhbWVUaW1lcigyMDAsIGJzLkNhbGwobGF1bmNoQm9tYikpCiAgICAgICAgICAgIGJzLmdhbWVUaW1lcigzMDAsIGJzLkNhbGwobGF1bmNoQm9tYikpCiAgICAgICAgICAgIGJzLmdhbWVUaW1lcig0MDAsIGJzLkNhbGwobGF1bmNoQm9tYikpCiAgICAgICAgICAgIGJzLmdhbWVUaW1lcig1MDAsIGJzLkNhbGwobGF1bmNoQm9tYikpCiAgICAgICAgICAgIGJzLmdhbWVUaW1lcig3MDAsIGJzLkNhbGwobGF1bmNoQm9tYikpCiAgICAgICAgICAgIGJzLmdhbWVUaW1lcig5MDAsIGJzLkNhbGwoc2VsZi5kcm9wKSkKCiAgICBkZWYgZHJvcChzZWxmKToKICAgICAgICBkZWYgbGF1bmNoQm9tYkRyb3AoKToKICAgICAgICAgICAgYnMucGxheVNvdW5kKGJzLmdldFNvdW5kKCdBaW0nKSkKICAgICAgICAgICAgYiA9IGJzLkJvbWIoCiAgICAgICAgICAgICAgICBwb3NpdGlvbj0oc2VsZi5wb3NbMF0rKC0yK3JhbmRvbS5yYW5kb20oKSo0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1heEhlaWdodFs0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnBvc1syXSsoLTIrcmFuZG9tLnJhbmRvbSgpKjQpKSwKICAgICAgICAgICAgICAgIHZlbG9jaXR5PSgwLCAtMTAwLCAwKSwKICAgICAgICAgICAgICAgIGJvbWJUeXBlPXNlbGYuYm9tYlR5cGUsCiAgICAgICAgICAgICAgICBzb3VyY2VQbGF5ZXI9c2VsZi5zb3VyY2VQbGF5ZXIpLmF1dG9SZXRhaW4oKQoKICAgICAgICAgICAgYi5ub2RlLmV4dHJhQWNjZWxlcmF0aW9uID0gKDAsIC0xMDAsIDApCgogICAgICAgIGJzLmdhbWVUaW1lcigxMDAsIGJzLkNhbGwobGF1bmNoQm9tYkRyb3ApKQogICAgICAgIGJzLmdhbWVUaW1lcigzMDAsIGJzLkNhbGwobGF1bmNoQm9tYkRyb3ApKQogICAgICAgIGJzLmdhbWVUaW1lcig1MDAsIGJzLkNhbGwobGF1bmNoQm9tYkRyb3ApKQogICAgICAgIGJzLmdhbWVUaW1lcig3MDAsIGJzLkNhbGwobGF1bmNoQm9tYkRyb3ApKQogICAgICAgIGJzLmdhbWVUaW1lcig5MDAsIGJzLkNhbGwobGF1bmNoQm9tYkRyb3ApKQogICAgICAgIGJzLmdhbWVUaW1lcigxMDAwLCBicy5DYWxsKGxhdW5jaEJvbWJEcm9wKSkKCmNsYXNzIEZsb2F0aW5nTGFuZE1pbmUoYnMuQWN0b3IpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwb3NpdGlvbj0oMCwxLDApKToKICAgICAgICBicy5BY3Rvci5fX2luaXRfXyhzZWxmKQogICAgICAgIHNlbGYubm9kZSA9IGJzLm5ld05vZGUoJ3Byb3AnLCBkZWxlZ2F0ZT1zZWxmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwb3NpdGlvbic6cG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JvZHknOidsYW5kTWluZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21vZGVsJzpicy5nZXRNb2RlbCgnbGFuZE1pbmUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JUZXh0dXJlJzpicy5nZXRUZXh0dXJlKCdiZycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzaGFkb3dTaXplJzowLjQ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uJzoncG93ZXJ1cCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZmxlY3Rpb25TY2FsZSc6WzUuMCwxLjUsMS4wXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWF0ZXJpYWxzJzpbYnMuZ2V0U2hhcmVkT2JqZWN0KCdvYmplY3RNYXRlcmlhbCcpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGlnaHRNb2RlbCc6YnMuZ2V0TW9kZWwoJ2xhbmRNaW5lJyl9KQoKICAgIGRlZiBoYW5kbGVNZXNzYWdlKHNlbGYsIG0pOgogICAgICAgIGlmIGlzaW5zdGFuY2UobSwgYnMuRGllTWVzc2FnZSk6CiAgICAgICAgICAgIHNlbGYubm9kZS5kZWxldGUoKQogICAgICAgICAgICBzZWxmLnRpbWVyID0gTm9uZQogICAgICAgIAogICAgICAgIGVsaWYgaXNpbnN0YW5jZShtLCBicy5PdXRPZkJvdW5kc01lc3NhZ2UpOgogICAgICAgICAgICBzZWxmLm5vZGUuZGVsZXRlKCkKICAgICAgICAgICAgc2VsZi50aW1lciA9IE5vbmUKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG0sIGJzLlBpY2tlZFVwTWVzc2FnZSk6CiAgICAgICAgICAgIHNlbGYubm9kZS5leHRyYUFjY2VsZXJhdGlvbiA9ICgwLDYwLDApCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGJzLkFjdG9yLmhhbmRsZU1lc3NhZ2Uoc2VsZiwgbSk='
exec(base64.b64decode(text))